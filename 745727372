local NexusLibrary = loadstring(game:HttpGet("https://raw.githubusercontent.com/XNEOFF/NexusUI/main/NexusUI-Library-V2.lua", true))()

local window = NexusLibrary:CreateWindow("墨水游戏多功能整合脚本")

if not getgenv().shared then
    getgenv().shared = {}
end

if getgenv().voidware_loaded then
    pcall(function()
        if shared.Voidware_InkGame_Library then
            shared.Voidware_InkGame_Library:Unload()
        end
    end)
end
getgenv().voidware_loaded = true

pcall(function()
    if not isfolder("voidware_linoria") then 
        makefolder("voidware_linoria")
        makefolder("voidware_linoria/ink_game")
        makefolder("voidware_linoria/themes")
        makefolder("voidware_linoria/ink_game/settings")
        makefolder("voidware_linoria/ink_game/themes")
        writefile("voidware_linoria/themes/default.txt", "Jester")
    end
end)

task.spawn(function()
    pcall(function()
        if not isfile("Local_VW_Update_Log.json") then
            shared.UpdateLogBypass = true
        end
        loadstring(game:HttpGet("https://raw.githubusercontent.com/VapeVoidware/VWExtra/main/VWUpdateLog.lua", true))()
        shared.UpdateLogBypass = nil
    end)
end)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Lighting = game:GetService("Lighting")

local lplr = Players.LocalPlayer
local localPlayer = lplr
local camera = workspace.CurrentCamera

local Script = {
    GameStateChanged = Instance.new("BindableEvent"),
    GameState = "unknown",
    Maid = {},
    Connections = {},
    Functions = {},
    ESPTable = {
        Player = {},
        Seeker = {},
        Hider = {},
        Guard = {},
        Door = {},
        Key = {},
        EscapeDoor = {}
    },
    Temp = {}
}

function Script.Functions.Alert(message, duration)
    window:ShowNotification(message, duration or 5)
    local sound = Instance.new("Sound", workspace)
    sound.SoundId = "rbxassetid://4590662766"
    sound.Volume = 2
    sound.PlayOnRemove = true
    sound:Destroy()
end

function Script.Functions.Warn(message)
    warn("WARN - voidware:", message)
end

function Script.Functions.SafeRequire(module)
    if Script.Temp[tostring(module)] then return Script.Temp[tostring(module)] end
    local suc, err = pcall(function()
        return require(module)
    end)
    if suc then
        Script.Temp[tostring(module)] = err
        return err
    else
        warn("[SafeRequire]: Failure loading "..tostring(module).." ("..tostring(err)..")")
        return nil
    end
end

function Script.Functions.JoinDiscordServer()
    local sInvite = "https://discord.com/invite/voidware"
    pcall(function()
        setclipboard("discord.gg/voidware")
    end)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "复制NOL dc - discord.gg/voidware",
        Text = "加入我们dc群 (discord.gg/voidware)",
        Duration = 10,
    })
end

function Script.Functions.GetRootPart()
    if not lplr.Character then return end
    local rp = lplr.Character:WaitForChild("HumanoidRootPart", 10)
    return rp
end

function Script.Functions.GetHumanoid()
    if not lplr.Character then return end
    local rp = lplr.Character:WaitForChild("Humanoid", 10)
    return rp
end

function Script.Functions.FixCamera()
    if workspace.CurrentCamera then
        pcall(function()
            workspace.CurrentCamera:Destroy()
        end)
    end
    local new = Instance.new("Camera")
    new.Parent = workspace
    workspace.CurrentCamera = new
    new.CameraType = Enum.CameraType.Custom
    if lplr.Character and lplr.Character:FindFirstChild("Humanoid") then
        new.CameraSubject = lplr.Character.Humanoid
    end
end

function Script.Functions.DistanceFromCharacter(position)
    if typeof(position) == "Instance" then
        position = position:GetPivot().Position
    end

    if not lplr.Character or not lplr.Character:FindFirstChild("HumanoidRootPart") then
        return (camera.CFrame.Position - position).Magnitude
    end

    return (lplr.Character.HumanoidRootPart.Position - position).Magnitude
end

local ESPConfig = {
    Highlight = true,
    ShowDistance = true,
    FillTransparency = 0.75,
    OutlineTransparency = 0,
    TextSize = 22
}

function Script.Functions.ESP(args)
    if not args.Object then return Script.Functions.Warn("ESP Object is nil") end

    local ESPManager = {
        Object = args.Object,
        Text = args.Text or "No Text",
        TextParent = args.TextParent,
        Color = args.Color or Color3.new(),
        Offset = args.Offset or Vector3.zero,
        IsEntity = args.IsEntity or false,
        Type = args.Type or "None",
        Highlights = {},
        RSConnection = nil
    }

    local tableIndex = #Script.ESPTable[ESPManager.Type] + 1

    if ESPManager.IsEntity and ESPManager.Object.PrimaryPart and ESPManager.Object.PrimaryPart.Transparency == 1 then
        ESPManager.Object:SetAttribute("Transparency", ESPManager.Object.PrimaryPart.Transparency)
        ESPManager.Object.PrimaryPart.Transparency = 0.99
    end

    local highlight = Instance.new("Highlight")
    highlight.Adornee = ESPManager.Object
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.FillColor = ESPManager.Color
    highlight.FillTransparency = ESPConfig.FillTransparency
    highlight.OutlineColor = ESPManager.Color
    highlight.OutlineTransparency = ESPConfig.OutlineTransparency
    highlight.Enabled = ESPConfig.Highlight
    highlight.Parent = ESPManager.Object

    table.insert(ESPManager.Highlights, highlight)

    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Adornee = ESPManager.TextParent or ESPManager.Object
    billboardGui.AlwaysOnTop = true
    billboardGui.ClipsDescendants = false
    billboardGui.Size = UDim2.new(0, 1, 0, 1)
    billboardGui.StudsOffset = ESPManager.Offset
    billboardGui.Parent = ESPManager.TextParent or ESPManager.Object

    local textLabel = Instance.new("TextLabel")
    textLabel.BackgroundTransparency = 1
    textLabel.Font = Enum.Font.Oswald
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.Text = ESPManager.Text
    textLabel.TextColor3 = ESPManager.Color
    textLabel.TextSize = ESPConfig.TextSize
    textLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
    textLabel.TextStrokeTransparency = 0.75
    textLabel.Parent = billboardGui

    function ESPManager.SetColor(newColor)
        ESPManager.Color = newColor
        for _, highlight in pairs(ESPManager.Highlights) do
            highlight.FillColor = newColor
            highlight.OutlineColor = newColor
        end
        textLabel.TextColor3 = newColor
    end

    function ESPManager.Destroy()
        if ESPManager.RSConnection then
            ESPManager.RSConnection:Disconnect()
        end
        if ESPManager.IsEntity and ESPManager.Object and ESPManager.Object.PrimaryPart then
            ESPManager.Object.PrimaryPart.Transparency = ESPManager.Object.PrimaryPart:GetAttribute("Transparency") or 1
        end
        for _, highlight in pairs(ESPManager.Highlights) do
            highlight:Destroy()
        end
        if billboardGui then billboardGui:Destroy() end
        if Script.ESPTable[ESPManager.Type][tableIndex] then
            Script.ESPTable[ESPManager.Type][tableIndex] = nil
        end
    end

    ESPManager.RSConnection = RunService.RenderStepped:Connect(function()
        if not ESPManager.Object or not ESPManager.Object:IsDescendantOf(workspace) then
            ESPManager.Destroy()
            return
        end
        for _, highlight in pairs(ESPManager.Highlights) do
            highlight.Enabled = ESPConfig.Highlight
            highlight.FillTransparency = ESPConfig.FillTransparency
            highlight.OutlineTransparency = ESPConfig.OutlineTransparency
        end
        textLabel.TextSize = ESPConfig.TextSize
        if ESPConfig.ShowDistance then
            textLabel.Text = string.format("%s\n[%s]", ESPManager.Text, math.floor(Script.Functions.DistanceFromCharacter(ESPManager.Object)))
        else
            textLabel.Text = ESPManager.Text
        end
    end)

    Script.ESPTable[ESPManager.Type][tableIndex] = ESPManager
    return ESPManager
end

local function updateESPConfig()
    for _, espType in pairs(Script.ESPTable) do
        for _, esp in pairs(espType) do
            if esp.SetColor then
                pcall(esp.SetColor, esp.Color)
            end
        end
    end
end

local GameStates = {}
local CurrentGameCheats = {}

function Script.Functions.WinRLGL()
    if not lplr.Character then return end
    lplr.Character:PivotTo(CFrame.new(Vector3.new(-100.8, 1030, 115)))
    Script.Functions.Alert("已传送到终点!", 3)
end

function Script.Functions.CompleteDalgonaGame()
    local args = {
        "Clicked"
    }
    game:GetService("ReplicatedStorage"):WaitForChild("Replication"):WaitForChild("Event"):FireServer(unpack(args))
    
    local args2 = {
        {
            Completed = true
        }
    }
    game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("DALGONATEMPREMPTE"):FireServer(unpack(args2))
    
    local args3 = {
        {
            Success = true
        }
    }
    game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("DALGONATEMPREMPTE"):FireServer(unpack(args3))
end

function Script.Functions.PullRope(perfect)
    local args = {
        {
            PerfectQTE = true
        }
    }
    game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("TemporaryReachedBindable"):FireServer(unpack(args))
end

function Script.Functions.RevealGlassBridge()
    local glassHolder = workspace:FindFirstChild("GlassBridge") and workspace.GlassBridge:FindFirstChild("GlassHolder")
    if not glassHolder then return end

    for _, tilePair in pairs(glassHolder:GetChildren()) do
        for _, tileModel in pairs(tilePair:GetChildren()) do
            if tileModel:IsA("Model") and tileModel.PrimaryPart then
                local primaryPart = tileModel.PrimaryPart
                local isBreakable = primaryPart:GetAttribute("exploitingisevil") == true
                local targetColor = isBreakable and Color3.fromRGB(255, 0, 0) or Color3.fromRGB(0, 255, 0)
                
                for _, part in pairs(tileModel:GetDescendants()) do
                    if part:IsA("BasePart") then
                        TweenService:Create(part, TweenInfo.new(0.5, Enum.EasingStyle.Linear), {
                            Transparency = 0.5,
                            Color = targetColor
                        }):Play()
                    end
                end
            end
        end
    end
    Script.Functions.Alert("安全玻璃是绿色的，易碎玻璃是红色的!", 10)
end

function Script.Functions.WinGlassBridge()
    if not lplr.Character then return end
    lplr.Character:PivotTo(CFrame.new(Vector3.new(-203.9, 520.7, -1534.3485)))
    Script.Functions.Alert("已传送到玻璃桥终点!", 3)
end

function Script.Functions.BypassRagdoll()
    local character = lplr.Character
    if not character then return end
    
    for _, child in ipairs(character:GetChildren()) do
        if child.Name == "Ragdoll" then
            pcall(function() child:Destroy() end)
        end
    end

    local humanoid = character:FindFirstChild("Humanoid")
    if humanoid then
        humanoid.PlatformStand = false
        humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
    end
end

local function getNearestEnemy(maxDist)
    maxDist = maxDist or 15
    local closest, closestDist = nil, math.huge
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= lplr and player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChild("Humanoid") then
            local hum = player.Character.Humanoid
            if hum.Health > 0 then
                local dist = (lplr.Character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
                if dist < closestDist and dist <= maxDist then
                    closest = player.Character.HumanoidRootPart
                    closestDist = dist
                end
            end
        end
    end
    return closest
end

local function getNearestGuard(maxDist)
    maxDist = maxDist or 50
    local closest, closestDist = nil, math.huge
    local live = workspace:FindFirstChild("Live")
    if not live then return end
    
    for _, model in pairs(live:GetChildren()) do
        if model:IsA("Model") and model:FindFirstChild("TypeOfGuard") then
            local part = model:FindFirstChild("HumanoidRootPart") or model:FindFirstChildWhichIsA("BasePart")
            if part then
                local dist = (lplr.Character.HumanoidRootPart.Position - part.Position).Magnitude
                if dist < closestDist and dist <= maxDist then
                    closest = part
                    closestDist = dist
                end
            end
        end
    end
    return closest
end

local PlayerSettings = {
    Speed = {
        Enabled = false,
        Value = 30,
        OldSpeed = 16
    },
    Noclip = {
        Enabled = false,
        NoclipParts = {}
    },
    Fly = {
        Enabled = false,
        Speed = 40,
        BodyVelocity = nil
    },
    InfiniteJump = {
        Enabled = false
    },
    AntiFling = {
        Enabled = false
    },
    AntiVoid = {
        Enabled = false,
        Part = nil
    },
    AntiAfk = {
        Enabled = true
    },
    Fullbright = {
        Enabled = false,
        OriginalSettings = {}
    }
}

local function applySpeed()
    if not PlayerSettings.Speed.Enabled or not lplr.Character then return end
    local humanoid = lplr.Character:FindFirstChild("Humanoid")
    if humanoid then
        humanoid.WalkSpeed = PlayerSettings.Speed.Value
    end
end

local function applyNoclip()
    if not PlayerSettings.Noclip.Enabled or not lplr.Character then return end
    for _, child in pairs(lplr.Character:GetDescendants()) do
        if child:IsA("BasePart") and child.CanCollide == true then
            child.CanCollide = false
            PlayerSettings.Noclip.NoclipParts[child] = true
        end
    end
end

local function removeNoclip()
    for part, _ in pairs(PlayerSettings.Noclip.NoclipParts) do
        if part and part:IsA("BasePart") then
            part.CanCollide = true
        end
    end
    PlayerSettings.Noclip.NoclipParts = {}
end

local function applyFly()
    if not PlayerSettings.Fly.Enabled then
        if PlayerSettings.Fly.BodyVelocity then
            PlayerSettings.Fly.BodyVelocity:Destroy()
            PlayerSettings.Fly.BodyVelocity = nil
        end
        return
    end
    
    local rootPart = Script.Functions.GetRootPart()
    if not rootPart then return end
    
    local humanoid = Script.Functions.GetHumanoid()
    if humanoid then
        humanoid.PlatformStand = true
    end
    
    if not PlayerSettings.Fly.BodyVelocity then
        PlayerSettings.Fly.BodyVelocity = Instance.new("BodyVelocity")
        PlayerSettings.Fly.BodyVelocity.Velocity = Vector3.zero
        PlayerSettings.Fly.BodyVelocity.MaxForce = Vector3.one * 9e9
        PlayerSettings.Fly.BodyVelocity.Parent = rootPart
    end
    
    local controlModule = Script.Functions.SafeRequire(lplr:WaitForChild("PlayerScripts"):WaitForChild("PlayerModule"):WaitForChild("ControlModule"))
    if controlModule then
        local moveVector = controlModule:GetMoveVector()
        local velocity = -((camera.CFrame.LookVector * moveVector.Z) - (camera.CFrame.RightVector * moveVector.X)) * PlayerSettings.Fly.Speed
        PlayerSettings.Fly.BodyVelocity.Velocity = velocity
    end
end

local function applyAntiVoid()
    if not PlayerSettings.AntiVoid.Enabled then
        if PlayerSettings.AntiVoid.Part then
            PlayerSettings.AntiVoid.Part:Destroy()
            PlayerSettings.AntiVoid.Part = nil
        end
        return
    end
    
    if not PlayerSettings.AntiVoid.Part then
        PlayerSettings.AntiVoid.Part = Instance.new("Part")
        PlayerSettings.AntiVoid.Part.Size = Vector3.new(10000, 1, 10000)
        PlayerSettings.AntiVoid.Part.Transparency = 0.5
        PlayerSettings.AntiVoid.Part.Material = Enum.Material.ForceField
        PlayerSettings.AntiVoid.Part.Color = Color3.fromRGB(0, 255, 255)
        PlayerSettings.AntiVoid.Part.CanCollide = true
        PlayerSettings.AntiVoid.Part.Anchored = true
        PlayerSettings.AntiVoid.Part.CanQuery = false
        PlayerSettings.AntiVoid.Part.Parent = workspace
        
        local debounce = tick()
        PlayerSettings.AntiVoid.Part.Touched:Connect(function(touchedPart)
            if touchedPart.Parent == lplr.Character and lplr.Character:FindFirstChild("Humanoid") and lplr.Character.Humanoid.Health > 0 and debounce < tick() then
                local rootPart = lplr.Character:FindFirstChild("HumanoidRootPart")
                if rootPart then
                    debounce = tick() + 0.1
                    rootPart.Velocity = Vector3.new(rootPart.Velocity.X, 100, rootPart.Velocity.Z)
                end
            end
        end)
    end
end

local function applyFullbright()
    if PlayerSettings.Fullbright.Enabled then
        if not next(PlayerSettings.Fullbright.OriginalSettings) then
            PlayerSettings.Fullbright.OriginalSettings = {
                Brightness = Lighting.Brightness,
                ClockTime = Lighting.ClockTime,
                FogEnd = Lighting.FogEnd,
                GlobalShadows = Lighting.GlobalShadows,
                OutdoorAmbient = Lighting.OutdoorAmbient,
                Ambient = Lighting.Ambient
            }
        end
        
        Lighting.Brightness = 2
        Lighting.ClockTime = 14
        Lighting.FogEnd = 100000
        Lighting.GlobalShadows = false
        Lighting.OutdoorAmbient = Color3.fromRGB(128, 128, 128)
        Lighting.Ambient = Color3.fromRGB(255, 255, 255)
    else
        if next(PlayerSettings.Fullbright.OriginalSettings) then
            for k, v in pairs(PlayerSettings.Fullbright.OriginalSettings) do
                Lighting[k] = v
            end
            PlayerSettings.Fullbright.OriginalSettings = {}
        end
    end
end

RunService.Heartbeat:Connect(function()
    applySpeed()
    if PlayerSettings.Noclip.Enabled then
        applyNoclip()
    end
    if PlayerSettings.Fly.Enabled then
        applyFly()
    end
    if PlayerSettings.AntiAfk.Enabled then
        local VirtualUser = game:GetService("VirtualUser")
        game:GetService("Players").LocalPlayer.Idled:Connect(function()
            VirtualUser:Button2Down(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
            wait(1)
            VirtualUser:Button2Up(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
        end)
    end
end)

UserInputService.JumpRequest:Connect(function()
    if PlayerSettings.InfiniteJump.Enabled and lplr.Character and lplr.Character:FindFirstChild("Humanoid") then
        lplr.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

local mainTab = window:AddTab("主要功能")

mainTab:AddLabel({
    text = "欢迎使用墨水游戏多功能脚本",
    size = 18
})

local gameCheatsGroup = mainTab:AddFolder("游戏作弊")

gameCheatsGroup:AddToggle({
    text = "自动获胜",
    state = false,
    callback = function(state)
        CurrentGameCheats.AutoWin = state
        if state then
            Script.Functions.Alert("自动获胜已启用", 3)
        end
    end
})

gameCheatsGroup:AddButton({
    text = "通关红绿灯",
    callback = Script.Functions.WinRLGL
})

gameCheatsGroup:AddButton({
    text = "通关扣糖饼",
    callback = Script.Functions.CompleteDalgonaGame
})

gameCheatsGroup:AddButton({
    text = "显示玻璃桥",
    callback = Script.Functions.RevealGlassBridge
})

gameCheatsGroup:AddButton({
    text = "通关玻璃桥",
    callback = Script.Functions.WinGlassBridge
})

local tugOfWarGroup = gameCheatsGroup:AddFolder("拔河设置")

local autoPullEnabled = false
tugOfWarGroup:AddToggle({
    text = "自动拔河",
    state = false,
    callback = function(state)
        autoPullEnabled = state
        if state then
            task.spawn(function()
                while autoPullEnabled and not Script.Temp.Unloaded do
                    Script.Functions.PullRope(true)
                    task.wait(0.1)
                end
            end)
        end
    end
})

tugOfWarGroup:AddToggle({
    text = "完美拔河",
    state = true,
    callback = function(state)
        CurrentGameCheats.PerfectPull = state
    end
})

local playerEnhanceGroup = mainTab:AddFolder("玩家增强")

playerEnhanceGroup:AddToggle({
    text = "速度增强",
    state = false,
    callback = function(state)
        PlayerSettings.Speed.Enabled = state
        if state then
            Script.Functions.Alert("速度增强已启用: " .. PlayerSettings.Speed.Value, 3)
        else
            if lplr.Character and lplr.Character:FindFirstChild("Humanoid") then
                lplr.Character.Humanoid.WalkSpeed = PlayerSettings.Speed.OldSpeed
            end
            Script.Functions.Alert("速度增强已禁用", 3)
        end
    end
})

playerEnhanceGroup:AddSlider({
    text = "移动速度",
    min = 16,
    max = 100,
    value = 30,
    callback = function(value)
        PlayerSettings.Speed.Value = value
        if PlayerSettings.Speed.Enabled then
            applySpeed()
        end
    end
})

playerEnhanceGroup:AddBind({
    text = "速度快捷键",
    key = Enum.KeyCode.C,
    hold = false,
    callback = function()
        PlayerSettings.Speed.Enabled = not PlayerSettings.Speed.Enabled
        playerEnhanceGroup:UpdateToggle("速度增强", PlayerSettings.Speed.Enabled)
        if PlayerSettings.Speed.Enabled then
            Script.Functions.Alert("速度增强已启用: " .. PlayerSettings.Speed.Value, 3)
        else
            Script.Functions.Alert("速度增强已禁用", 3)
        end
    end
})

playerEnhanceGroup:AddToggle({
    text = "穿墙模式",
    state = false,
    callback = function(state)
        PlayerSettings.Noclip.Enabled = state
        if not state then
            removeNoclip()
        end
        if state then
            Script.Functions.Alert("穿墙模式已启用", 3)
        else
            Script.Functions.Alert("穿墙模式已禁用", 3)
        end
    end
})

playerEnhanceGroup:AddBind({
    text = "穿墙快捷键",
    key = Enum.KeyCode.N,
    hold = false,
    callback = function()
        PlayerSettings.Noclip.Enabled = not PlayerSettings.Noclip.Enabled
        playerEnhanceGroup:UpdateToggle("穿墙模式", PlayerSettings.Noclip.Enabled)
        if not PlayerSettings.Noclip.Enabled then
            removeNoclip()
        end
        if PlayerSettings.Noclip.Enabled then
            Script.Functions.Alert("穿墙模式已启用", 3)
        else
            Script.Functions.Alert("穿墙模式已禁用", 3)
        end
    end
})

playerEnhanceGroup:AddToggle({
    text = "无限跳跃",
    state = false,
    callback = function(state)
        PlayerSettings.InfiniteJump.Enabled = state
        if state then
            Script.Functions.Alert("无限跳跃已启用", 3)
        else
            Script.Functions.Alert("无限跳跃已禁用", 3)
        end
    end
})

playerEnhanceGroup:AddToggle({
    text = "飞行模式",
    state = false,
    callback = function(state)
        PlayerSettings.Fly.Enabled = state
        if state then
            Script.Functions.Alert("飞行模式已启用", 3)
        else
            Script.Functions.Alert("飞行模式已禁用", 3)
        end
    end
})

playerEnhanceGroup:AddSlider({
    text = "飞行速度",
    min = 10,
    max = 100,
    value = 40,
    callback = function(value)
        PlayerSettings.Fly.Speed = value
    end
})

playerEnhanceGroup:AddToggle({
    text = "反虚空",
    state = false,
    callback = function(state)
        PlayerSettings.AntiVoid.Enabled = state
        applyAntiVoid()
        if state then
            Script.Functions.Alert("反虚空已启用", 3)
        else
            Script.Functions.Alert("反虚空已禁用", 3)
        end
    end
})

playerEnhanceGroup:AddToggle({
    text = "反挂机",
    state = true,
    callback = function(state)
        PlayerSettings.AntiAfk.Enabled = state
        if state then
            Script.Functions.Alert("反挂机已启用", 3)
        else
            Script.Functions.Alert("反挂机已禁用", 3)
        end
    end
})

playerEnhanceGroup:AddToggle({
    text = "反布娃娃",
    state = false,
    callback = function(state)
        if state then
            Script.Functions.BypassRagdoll()
            task.spawn(function()
                while state and not Script.Temp.Unloaded do
                    Script.Functions.BypassRagdoll()
                    task.wait(0.1)
                end
            end)
            Script.Functions.Alert("反布娃娃已启用", 3)
        else
            Script.Functions.Alert("反布娃娃已禁用", 3)
        end
    end
})

local espTab = window:AddTab("ESP绘制")

local playerESPGroup = espTab:AddFolder("玩家ESP")

local playerESPEnabled = false
local playerESPColor = Color3.fromRGB(255, 255, 255)
playerESPGroup:AddToggle({
    text = "玩家ESP",
    state = false,
    callback = function(state)
        playerESPEnabled = state
        if state then
            for _, player in pairs(Players:GetPlayers()) do
                if player ~= lplr and player.Character and player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health > 0 then
                    Script.Functions.ESP({
                        Type = "Player",
                        Object = player.Character,
                        Text = player.DisplayName,
                        Color = playerESPColor,
                        Offset = Vector3.new(0, 3, 0)
                    })
                end
            end
            Script.Functions.Alert("玩家ESP已启用", 3)
        else
            for _, esp in pairs(Script.ESPTable.Player) do
                esp.Destroy()
            end
            Script.ESPTable.Player = {}
            Script.Functions.Alert("玩家ESP已禁用", 3)
        end
    end
})

playerESPGroup:AddColor({
    text = "玩家颜色",
    color = Color3.fromRGB(255, 255, 255),
    callback = function(color)
        playerESPColor = color
        for _, esp in pairs(Script.ESPTable.Player) do
            esp.SetColor(color)
        end
    end
})

local hideSeekESPGroup = espTab:AddFolder("捉迷藏ESP")

local hiderESPEnabled = false
local hiderESPColor = Color3.fromRGB(0, 255, 0)
hideSeekESPGroup:AddToggle({
    text = "隐藏者ESP",
    state = false,
    callback = function(state)
        hiderESPEnabled = state
        if state then
            for _, player in pairs(Players:GetPlayers()) do
                if player:GetAttribute("IsHider") and player.Character then
                    Script.Functions.ESP({
                        Type = "Hider",
                        Object = player.Character,
                        Text = player.Name .. " (Hider)",
                        Color = hiderESPColor,
                        Offset = Vector3.new(0, 3, 0)
                    })
                end
            end
            Script.Functions.Alert("隐藏者ESP已启用", 3)
        else
            for _, esp in pairs(Script.ESPTable.Hider) do
                esp.Destroy()
            end
            Script.ESPTable.Hider = {}
            Script.Functions.Alert("隐藏者ESP已禁用", 3)
        end
    end
})

hideSeekESPGroup:AddColor({
    text = "隐藏者颜色",
    color = Color3.fromRGB(0, 255, 0),
    callback = function(color)
        hiderESPColor = color
        for _, esp in pairs(Script.ESPTable.Hider) do
            esp.SetColor(color)
        end
    end
})

local seekerESPEnabled = false
local seekerESPColor = Color3.fromRGB(255, 0, 0)
hideSeekESPGroup:AddToggle({
    text = "寻找者ESP",
    state = false,
    callback = function(state)
        seekerESPEnabled = state
        if state then
            for _, player in pairs(Players:GetPlayers()) do
                if not player:GetAttribute("IsHider") and player.Character then
                    Script.Functions.ESP({
                        Type = "Seeker",
                        Object = player.Character,
                        Text = player.Name .. " (Seeker)",
                        Color = seekerESPColor,
                        Offset = Vector3.new(0, 3, 0)
                    })
                end
            end
            Script.Functions.Alert("寻找者ESP已启用", 3)
        else
            for _, esp in pairs(Script.ESPTable.Seeker) do
                esp.Destroy()
            end
            Script.ESPTable.Seeker = {}
            Script.Functions.Alert("寻找者ESP已禁用", 3)
        end
    end
})

hideSeekESPGroup:AddColor({
    text = "寻找者颜色",
    color = Color3.fromRGB(255, 0, 0),
    callback = function(color)
        seekerESPColor = color
        for _, esp in pairs(Script.ESPTable.Seeker) do
            esp.SetColor(color)
        end
    end
})

local espSettingsGroup = espTab:AddFolder("ESP设置")

espSettingsGroup:AddToggle({
    text = "显示距离",
    state = true,
    callback = function(state)
        ESPConfig.ShowDistance = state
        updateESPConfig()
    end
})

espSettingsGroup:AddToggle({
    text = "高亮绘制",
    state = true,
    callback = function(state)
        ESPConfig.Highlight = state
        updateESPConfig()
    end
})

espSettingsGroup:AddSlider({
    text = "填充透明度",
    min = 0,
    max = 100,
    value = 75,
    callback = function(value)
        ESPConfig.FillTransparency = value / 100
        updateESPConfig()
    end
})

espSettingsGroup:AddSlider({
    text = "边缘透明度",
    min = 0,
    max = 100,
    value = 0,
    callback = function(value)
        ESPConfig.OutlineTransparency = value / 100
        updateESPConfig()
    end
})

espSettingsGroup:AddSlider({
    text = "文字大小",
    min = 16,
    max = 26,
    value = 22,
    callback = function(value)
        ESPConfig.TextSize = value
        updateESPConfig()
    end
})

local combatTab = window:AddTab("战斗功能")

local killauraGroup = combatTab:AddFolder("杀戮光环")

local killauraEnabled = false
local killauraRange = 15
local killauraFaceTarget = true
killauraGroup:AddToggle({
    text = "杀戮光环",
    state = false,
    callback = function(state)
        killauraEnabled = state
        if state then
            task.spawn(function()
                while killauraEnabled and not Script.Temp.Unloaded do
                    local target = getNearestEnemy(killauraRange)
                    if target and lplr.Character and lplr.Character:FindFirstChild("HumanoidRootPart") then
                        if killauraFaceTarget then
                            local look = (target.Position - lplr.Character.HumanoidRootPart.Position).Unit
                            lplr.Character.HumanoidRootPart.CFrame = CFrame.new(lplr.Character.HumanoidRootPart.Position, lplr.Character.HumanoidRootPart.Position + look)
                        end
                        local args = {
                            CFrame.new(lplr.Character.HumanoidRootPart.Position)
                        }
                        game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("rootCFrame"):FireServer(unpack(args))
                    end
                    task.wait(0.5)
                end
            end)
            Script.Functions.Alert("杀戮光环已启用", 3)
        else
            Script.Functions.Alert("杀戮光环已禁用", 3)
        end
    end
})

killauraGroup:AddToggle({
    text = "静默自瞄",
    state = true,
    callback = function(state)
        killauraFaceTarget = state
    end
})

killauraGroup:AddSlider({
    text = "攻击范围",
    min = 5,
    max = 30,
    value = 15,
    callback = function(value)
        killauraRange = value
    end
})

local aimbotGroup = combatTab:AddFolder("自瞄设置")

local guardAimbotEnabled = false
local playerAimbotEnabled = false
local aimbotSpeed = 0.2
local aimbotWallcheck = true
local aimbotConnection = nil

local function updateAimbot()
    if aimbotConnection then
        aimbotConnection:Disconnect()
        aimbotConnection = nil
    end
    
    if guardAimbotEnabled or playerAimbotEnabled then
        aimbotConnection = RunService.RenderStepped:Connect(function()
            if not (guardAimbotEnabled or playerAimbotEnabled) or not lplr.Character then return end
            
            local target = nil
            if guardAimbotEnabled then
                target = getNearestGuard(100)
            end
            
            if playerAimbotEnabled and not target then
                target = getNearestEnemy(100)
            end
            
            if target then
                local look = (target.Position - camera.CFrame.Position).Unit
                camera.CFrame = camera.CFrame:Lerp(CFrame.new(camera.CFrame.Position, camera.CFrame.Position + look), aimbotSpeed)
            end
        end)
    end
end

aimbotGroup:AddToggle({
    text = "瞄准守卫",
    state = false,
    callback = function(state)
        guardAimbotEnabled = state
        updateAimbot()
    end
})

aimbotGroup:AddToggle({
    text = "瞄准玩家",
    state = false,
    callback = function(state)
        playerAimbotEnabled = state
        updateAimbot()
    end
})

aimbotGroup:AddToggle({
    text = "墙壁检测",
    state = true,
    callback = function(state)
        aimbotWallcheck = state
    end
})

aimbotGroup:AddSlider({
    text = "自瞄速度",
    min = 1,
    max = 100,
    value = 20,
    callback = function(value)
        aimbotSpeed = value / 100
    end
})

local utilityTab = window:AddTab("辅助功能")

local visualGroup = utilityTab:AddFolder("视觉设置")

visualGroup:AddToggle({
    text = "全亮视野",
    state = false,
    callback = function(state)
        PlayerSettings.Fullbright.Enabled = state
        applyFullbright()
        if state then
            Script.Functions.Alert("全亮视野已启用", 3)
        else
            Script.Functions.Alert("全亮视野已禁用", 3)
        end
    end
})

local customFOVEnabled = false
local customFOVValue = 60
local originalFOV = 70
visualGroup:AddToggle({
    text = "自定义视角",
    state = false,
    callback = function(state)
        customFOVEnabled = state
        if state then
            originalFOV = camera.FieldOfView
            camera.FieldOfView = customFOVValue
            Script.Functions.Alert("自定义视角已启用: " .. customFOVValue, 3)
        else
            camera.FieldOfView = originalFOV
            Script.Functions.Alert("自定义视角已禁用", 3)
        end
    end
})

visualGroup:AddSlider({
    text = "视角大小",
    min = 10,
    max = 120,
    value = 60,
    callback = function(value)
        customFOVValue = value
        if customFOVEnabled then
            camera.FieldOfView = value
        end
    end
})

local performanceGroup = utilityTab:AddFolder("性能优化")

performanceGroup:AddToggle({
    text = "低画质模式",
    state = false,
    callback = function(state)
        if state then
            pcall(function()
                settings().Rendering.QualityLevel = 1
            end)
            Lighting.GlobalShadows = false
            Lighting.FogEnd = 9e9
            Script.Functions.Alert("低画质模式已启用", 3)
        else
            pcall(function()
                settings().Rendering.QualityLevel = 10
            end)
            Lighting.GlobalShadows = true
            Lighting.FogEnd = 1000
            Script.Functions.Alert("低画质模式已禁用", 3)
        end
    end
})

performanceGroup:AddButton({
    text = "清除特效缓存",
    callback = function()
        if workspace:FindFirstChild("Effects") then
            workspace.Effects:ClearAllChildren()
            Script.Functions.Alert("特效缓存已清除", 3)
        end
    end
})

local infoTab = window:AddTab("脚本信息")

infoTab:AddLabel({
    text = "墨水游戏多功能整合脚本",
    size = 20
})

infoTab:AddLabel({
    text = "整合NOL和地岩版本功能"
})

infoTab:AddLabel({
    text = "使用NexusUI界面"
})

infoTab:AddButton({
    text = "加入Discord服务器",
    callback = Script.Functions.JoinDiscordServer
})

infoTab:AddButton({
    text = "修复视角",
    callback = Script.Functions.FixCamera
})

infoTab:AddButton({
    text = "卸载脚本",
    callback = function()
        Script.Temp.Unloaded = true
        
        for _, conn in pairs(Script.Connections) do
            pcall(conn.Disconnect, conn)
        end
        
        for _, espType in pairs(Script.ESPTable) do
            for _, esp in pairs(espType) do
                pcall(esp.Destroy)
            end
        end
        
        if PlayerSettings.Fly.BodyVelocity then
            PlayerSettings.Fly.BodyVelocity:Destroy()
        end
        
        if PlayerSettings.AntiVoid.Part then
            PlayerSettings.AntiVoid.Part:Destroy()
        end
        
        applyFullbright()
        
        if lplr.Character and lplr.Character:FindFirstChild("Humanoid") then
            lplr.Character.Humanoid.WalkSpeed = PlayerSettings.Speed.OldSpeed
        end
        
        removeNoclip()
        
        getgenv().voidware_loaded = false
        shared.Voidware_InkGame_Library = nil
        
        window:Destroy()
        Script.Functions.Alert("脚本已卸载", 3)
    end
})

local settingsTab = window:AddTab("设置")

settingsTab:AddLabel({
    text = "UI设置"
})

settingsTab:AddBind({
    text = "显示/隐藏菜单",
    key = Enum.KeyCode.RightShift,
    hold = false,
    callback = function()
        window:Toggle()
    end
})

settingsTab:AddToggle({
    text = "显示自定义光标",
    state = true,
    callback = function(state)
        NexusLibrary.ShowCustomCursor = state
    end
})

settingsTab:AddToggle({
    text = "显示按键绑定菜单",
    state = false,
    callback = function(state)
        NexusLibrary.KeybindFrame.Visible = state
    end
})

settingsTab:AddButton({
    text = "保存设置",
    callback = function()
        pcall(function()
            local settings = {
                PlayerSettings = PlayerSettings,
                ESPConfig = ESPConfig,
                GameCheats = CurrentGameCheats
            }
            writefile("voidware_linoria/ink_game/settings/nexusui.json", HttpService:JSONEncode(settings))
            Script.Functions.Alert("设置已保存", 3)
        end)
    end
})

settingsTab:AddButton({
    text = "加载设置",
    callback = function()
        pcall(function()
            if isfile("voidware_linoria/ink_game/settings/nexusui.json") then
                local settings = HttpService:JSONDecode(readfile("voidware_linoria/ink_game/settings/nexusui.json"))
                PlayerSettings = settings.PlayerSettings or PlayerSettings
                ESPConfig = settings.ESPConfig or ESPConfig
                CurrentGameCheats = settings.GameCheats or CurrentGameCheats
                
                updateESPConfig()
                applyFullbright()
                Script.Functions.Alert("设置已加载", 3)
            end
        end)
    end
})

settingsTab:AddButton({
    text = "重置设置",
    callback = function()
        PlayerSettings = {
            Speed = {Enabled = false, Value = 30, OldSpeed = 16},
            Noclip = {Enabled = false, NoclipParts = {}},
            Fly = {Enabled = false, Speed = 40, BodyVelocity = nil},
            InfiniteJump = {Enabled = false},
            AntiFling = {Enabled = false},
            AntiVoid = {Enabled = false, Part = nil},
            AntiAfk = {Enabled = true},
            Fullbright = {Enabled = false, OriginalSettings = {}}
        }
        
        ESPConfig = {
            Highlight = true,
            ShowDistance = true,
            FillTransparency = 0.75,
            OutlineTransparency = 0,
            TextSize = 22
        }
        
        CurrentGameCheats = {}
        
        updateESPConfig()
        applyFullbright()
        Script.Functions.Alert("设置已重置", 3)
    end
})

window:Init()

Script.Functions.Alert("墨水游戏多功能脚本已加载!", 5)
task.delay(2, function()
    Script.Functions.Alert("加入 discord.gg/voidware 获取更新", 5)
end)
